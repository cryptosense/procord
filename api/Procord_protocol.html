<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="previous" href="Procord_process.html">
<link rel="next" href="Procord_rope.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Procord_connection" rel="Chapter" href="Procord_connection.html">
<link title="Procord_process" rel="Chapter" href="Procord_process.html">
<link title="Procord_protocol" rel="Chapter" href="Procord_protocol.html">
<link title="Procord_rope" rel="Chapter" href="Procord_rope.html">
<link title="Procord_task" rel="Chapter" href="Procord_task.html">
<link title="Procord_worker" rel="Chapter" href="Procord_worker.html"><link title="Errors" rel="Section" href="#2_Errors">
<link title="Messages" rel="Section" href="#2_Messages">
<link title="Non-Blocking Functions" rel="Section" href="#2_NonBlockingFunctions">
<link title="Blocking Functions" rel="Section" href="#2_BlockingFunctions">
<link title="Protocol Description" rel="Section" href="#2_ProtocolDescription">
<title>Procord_protocol</title>
</head>
<body>
<div class="navbar"><a href="Procord_process.html">Previous</a>
&nbsp;<a href="index.html">Up</a>
&nbsp;<a href="Procord_rope.html">Next</a>
</div>
<center><h1>Module <a href="type_Procord_protocol.html">Procord_protocol</a></h1></center>
<br>
<pre><span class="keyword">module</span> Procord_protocol: <code class="code">sig</code> <a href="Procord_protocol.html">..</a> <code class="code">end</code></pre>Communication protocol between workers and main programs.<br>
<hr width="100%">
<br>
<span id="2_Errors"><h2>Errors</h2></span><br>
<br><code><span id="TYPEerror"><span class="keyword">type</span> <code class="type"></code>error</span> = </code><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span class="constructor">E_task_not_supported</span></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span class="constructor">E_unexpected_message</span></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span class="constructor">E_ill_formed_message</span></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span class="constructor">E_message_too_long</span></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span class="constructor">E_disconnected</span></code></td>

</tr></table>

<div class="info">
Errors from workers and protocol errors.<br>
</div>

<pre><span id="EXCEPTIONError"><span class="keyword">exception</span> Error</span> <span class="keyword">of</span> <code class="type"><a href="Procord_protocol.html#TYPEerror">error</a></code></pre>
<div class="info">
An error has occurred.<br>
</div>
<pre><span id="VALerror"><span class="keyword">val</span> error</span> : <code class="type"><a href="Procord_protocol.html#TYPEerror">error</a> -> 'a</code></pre><div class="info">
Raise an error.<br>
</div>
<pre><span id="VALerror_message"><span class="keyword">val</span> error_message</span> : <code class="type"><a href="Procord_protocol.html#TYPEerror">error</a> -> string</code></pre><div class="info">
Return a string explaining an error in English.<br>
</div>
<br>
<span id="2_Messages"><h2>Messages</h2></span><br>
<br><code><span id="TYPEmessage"><span class="keyword">type</span> <code class="type"></code>message</span> = </code><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span class="constructor">M_none</span></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span class="constructor">M_value</span> <span class="keyword">of</span> <code class="type">string</code></code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" >Serialized input or output.</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span class="constructor">M_task_name</span> <span class="keyword">of</span> <code class="type">string</code></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span class="constructor">M_exception</span> <span class="keyword">of</span> <code class="type">string</code></code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" >Serialized exception.</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span class="constructor">M_unknown_exception</span> <span class="keyword">of</span> <code class="type">string</code></code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" >Exception as a string using <code class="code">Printexc</code>.</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span class="constructor">M_error</span> <span class="keyword">of</span> <code class="type"><a href="Procord_protocol.html#TYPEerror">error</a></code></code></td>

</tr></table>

<div class="info">
Messages that can be received.<br>
</div>

<pre><span id="VALset_max_message_size"><span class="keyword">val</span> set_max_message_size</span> : <code class="type">int -> unit</code></pre><div class="info">
Set the maximum size of packets.
<p>

      If you know that your serialized values, exceptions and task names
      are never longer than <code class="code">n</code> bytes, consider setting the maximum message
      size to <code class="code">n</code>. Otherwise someone can send a ridiculous size, then the
      same ridiculous amount of data, and your process will buffer it all,
      possibly running out of memory.
<p>

      By default the maximum size is <code class="code">max_int</code>.<br>
</div>
<br>
<span id="2_NonBlockingFunctions"><h2>Non-Blocking Functions</h2></span><br>
<pre><span id="VALsend"><span class="keyword">val</span> send</span> : <code class="type">'a <a href="Procord_connection.html#TYPEt">Procord_connection.t</a> -> <a href="Procord_protocol.html#TYPEmessage">message</a> -> unit</code></pre><div class="info">
Send a message.<br>
</div>
<pre><span id="VALsend_value"><span class="keyword">val</span> send_value</span> : <code class="type">'a <a href="Procord_connection.html#TYPEt">Procord_connection.t</a> -> string -> unit</code></pre><div class="info">
Send a value (input or output).<br>
</div>
<pre><span id="VALsend_task_name"><span class="keyword">val</span> send_task_name</span> : <code class="type">'a <a href="Procord_connection.html#TYPEt">Procord_connection.t</a> -> string -> unit</code></pre><div class="info">
Send the name of the task to execute.<br>
</div>
<pre><span id="VALsend_exception"><span class="keyword">val</span> send_exception</span> : <code class="type">'a <a href="Procord_connection.html#TYPEt">Procord_connection.t</a> -> string -> unit</code></pre><div class="info">
Send an exception message.<br>
</div>
<pre><span id="VALsend_unknown_exception"><span class="keyword">val</span> send_unknown_exception</span> : <code class="type">'a <a href="Procord_connection.html#TYPEt">Procord_connection.t</a> -> string -> unit</code></pre><div class="info">
Send an unknown exception message.<br>
</div>
<pre><span id="VALsend_error"><span class="keyword">val</span> send_error</span> : <code class="type">'a <a href="Procord_connection.html#TYPEt">Procord_connection.t</a> -> <a href="Procord_protocol.html#TYPEerror">error</a> -> unit</code></pre><div class="info">
Send an error message.<br>
</div>
<pre><span id="VALreceive"><span class="keyword">val</span> receive</span> : <code class="type">'a <a href="Procord_connection.html#TYPEt">Procord_connection.t</a> -> <a href="Procord_protocol.html#TYPEmessage">message</a></code></pre><div class="info">
Try to receive a message from a connection.
<p>

      May raise <code class="code">Error E_ill_formed_message</code>.<br>
</div>
<br>
<span id="2_BlockingFunctions"><h2>Blocking Functions</h2></span><br>
<pre><span id="VALblocking_receive"><span class="keyword">val</span> blocking_receive</span> : <code class="type">'a <a href="Procord_connection.html#TYPEt">Procord_connection.t</a> -> <a href="Procord_protocol.html#TYPEmessage">message</a></code></pre><div class="info">
Receive a message.
<p>

      May raise <code class="code">Error</code>.<br>
</div>
<pre><span id="VALblocking_receive_task_name"><span class="keyword">val</span> blocking_receive_task_name</span> : <code class="type">'a <a href="Procord_connection.html#TYPEt">Procord_connection.t</a> -> string</code></pre><div class="info">
Receive a task name.
<p>

      May raise <code class="code">Error</code>.<br>
</div>
<pre><span id="VALblocking_receive_value"><span class="keyword">val</span> blocking_receive_value</span> : <code class="type">'a <a href="Procord_connection.html#TYPEt">Procord_connection.t</a> -> string</code></pre><div class="info">
Receive a serialized value.
<p>

      May raise <code class="code">Error</code>.<br>
</div>
<br>
<span id="2_ProtocolDescription"><h2>Protocol Description</h2></span><br>
<br>
A sequence of messages is sent on the connection. (See type <code class="code">message</code>.)
    Nothing else can be sent, and <code class="code">M_none</code> cannot really be sent either.
<p>

    Each message is of the form:
<p>

    SIZE KIND BODY
<p>

    The SIZE is a sequence of ASCII digits (<code class="code">'0'</code> to <code class="code">'9'</code>).
    The KIND is a single character which is not a digit.
    The BODY is a string of SIZE bytes.
<p>

    Each message has a specific KIND and a specific way to handle BODY:
<p>
<ul>
<li><code class="code">M_value</code>:
      KIND <code class="code">'V'</code>;
      BODY is to be deserialized using the user function <code class="code">read_input</code>
        (for the worker) or <code class="code">read_output</code> (for the main program).</li>
</ul>
<ul>
<li><code class="code">M_task_name</code>:
      KIND <code class="code">'T'</code>;
      BODY is the task name.</li>
</ul>
<ul>
<li><code class="code">M_exception</code>:
      KIND <code class="code">'X'</code>;
      BODY is to be deserialized using the user function <code class="code">read_exception</code>.</li>
</ul>
<ul>
<li><code class="code">M_unknown_exception</code>:
      KIND <code class="code">'U'</code>;
      BODY is the exception as a string using <code class="code">Printexc</code>.</li>
</ul>
<ul>
<li><code class="code">M_error</code>:
      KIND <code class="code">'E'</code>;
      BODY is one of those (quotes not included):
        <code class="code">"0"</code> - <code class="code">E_task_not_supported</code>;
        <code class="code">"1"</code> - <code class="code">E_unexpected_message</code>;
        <code class="code">"2"</code> - <code class="code">E_ill_formed_message</code>;
        <code class="code">"3"</code> - <code class="code">E_message_too_long</code>;
        <code class="code">"4"</code> - <code class="code">E_disconnected</code>.</li>
</ul>

    Examples:
<p>
<ul>
<li><code class="code">"1E2"</code> has SIZE 1, KIND <code class="code">'E'</code> (M_error),
      and BODY <code class="code">"2"</code> (<code class="code">E_disconnected</code>).</li>
</ul>
<ul>
<li><code class="code">"5Thelloworld"</code> has SIZE 5, KIND <code class="code">'T'</code> (M_task_name),
      and BODY <code class="code">"hello"</code>.
      Remainder <code class="code">"world"</code> is not part of the message.</li>
</ul>
<br>
</body></html>